rule Malware_156c21d06df1
{
    meta:
        author = "malware-analyst"
        description = "Text-log detection for sample SHA256 156c21d06df1... â€” targets uncommon IME/ACM/SetupDi/MSCoree indicators (text-only)."
        sha256 = "156c21d06df1eff6f8779151dc74a7b785b8a696f90fb37b0b2655145949c74e"
        date = "2025-11-30"
        classification = "suspicious"

    strings:
        // DLL indicator not present in benign neighbors
        $mscoree = "mscoree.dll" nocase

        // Core/launcher / .NET entrypoint string (unique)
        $corexemain = "corexemain" nocase

        // Uncommon IME / keyboard APIs (rare in benign neighbors)
        $immsim = "immsimulatehotkey" nocase
        $imm_get_clock = "immgetimclockcount" nocase
        $imm_candidate_count = "immgetcandidatelistcounta" nocase
        $immdestroy = "immdestroyimcc" nocase
        $oemkeyscan = "oemkeyscan" nocase

        // Audio Compression Manager / driver / setup APIs
        $acm_reset = "acmstreamreset" nocase
        $acm_close = "acmstreamclose" nocase
        $acm_driver = "acmdriverdetailsw" nocase
        $acm_format = "acmformatdetailsw" nocase
        $acm_getver = "acmgetversion" nocase

        // SetupDi device/class installation strings (device installer APIs)
        $setupdi_install_dev = "setupdiinstalldevice" nocase
        $setupdi_install_class = "setupdiinstallclassw" nocase
        $setupdi_get_class_imagelist = "setupdigetclassimagelist" nocase
        $setupdi_add_to_source = "setupaddtosourcelista" nocase

        // Certificate / EKU related (rare)
        $cert_eku = "certaddenhancedkeyusageidentifier" nocase
        $cert_enum_crl = "certenumcrlcontextproperties" nocase

    condition:
        // Target is a text log. To avoid matching benign samples, require the .NET/runtime DLL plus
        // at least two uncommon technical indicators (IME/ACM/SetupDi/Cert). This reduces false positives
        // because benign neighbors contain common UI APIs (showwindow, drawmenubar, getdevicecaps) which we do NOT use.
        $mscoree and 2 of (
            $corexemain,
            $immsim,
            $imm_get_clock,
            $imm_candidate_count,
            $immdestroy,
            $oemkeyscan,
            $acm_reset,
            $acm_close,
            $acm_driver,
            $acm_format,
            $acm_getver,
            $setupdi_install_dev,
            $setupdi_install_class,
            $setupdi_get_class_imagelist,
            $setupdi_add_to_source,
            $cert_eku,
            $cert_enum_crl
        )
}
