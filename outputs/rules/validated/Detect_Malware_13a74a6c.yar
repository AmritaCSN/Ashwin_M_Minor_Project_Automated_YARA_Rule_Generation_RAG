rule Detect_WinMM_Dropper_Behavioral
{
    meta:
        description = "Detects Malware combining Multimedia APIs with Windowing APIs. Avoids volatile PE header fields."
        author = "malware-analyst"
        date = "2025-12-01"
        confidence = "Medium"

    strings:
        $quirk_dll      = "winmm.dll"
        $quirk_func     = "playsound"

        $gui_1          = "registerclassex"
        $gui_2          = "createwindow"
        $gui_3          = "defwindowproc"
        $gui_4          = "dispatchmessage"

        $suspicious_1   = "gettemppath"
        $suspicious_2   = "writefile"
        $suspicious_3   = "winexec"

        $safe_1         = "Microsoft Corporation"
        $safe_2         = "Windows System"

    condition:
        $quirk_dll and $quirk_func
        and 2 of ($gui_*)
        and 1 of ($suspicious_*)
        and not any of ($safe_*)
}
