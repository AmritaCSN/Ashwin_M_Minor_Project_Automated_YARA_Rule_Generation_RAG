rule Detect_New_Malware_a0d14917
{
    meta:
        description = "Detects text-log based malware sample a0d14917 and neighbors using specific API and DLL indicators related to resource updating and variant handling."
        author = "malware-analyst"
        sha256 = "a0d1491726a47bc5fa97a7dee7718557fabbb2417d48ae79dca8302d5106604c"
        created = "2023-10-27"

    strings:
        /* Behavioral Indicators (APIs from new sample and neighbors) */
        $api_raiseexception            = "raiseexception" nocase
        $api_variantchangetypeex       = "variantchangetypeex" nocase
        $api_getprocesswindowstation   = "getprocesswindowstation" nocase
        $api_findwindowa               = "findwindowa" nocase

        /* Contextual APIs (Present in target but common, used for context) */
        $api_getprocaddress            = "getprocaddress" nocase
        $api_getmodulehandlea          = "getmodulehandlea" nocase
        $api_loadlibrarya              = "loadlibrarya" nocase

        /* Imported DLLs */
        $dll_oleaut32                  = "oleaut32.dll" nocase
        $dll_user32                    = "user32.dll" nocase
        $dll_kernel32                  = "kernel32.dll" nocase

    condition:
        /*
         Logic:
         - Require the three contextual DLLs AND
         - the uncommon pair VariantChangeTypeEx + (GetProcessWindowStation or FindWindowA)
         - plus at least one contextual/supporting API (RaiseException or one of the dynamic resolution APIs)
        */
        $dll_oleaut32 and $dll_user32 and $dll_kernel32 and
        $api_variantchangetypeex and
        ( $api_getprocesswindowstation or $api_findwindowa ) and
        ( $api_raiseexception or $api_getprocaddress or $api_getmodulehandlea or $api_loadlibrarya )
}
