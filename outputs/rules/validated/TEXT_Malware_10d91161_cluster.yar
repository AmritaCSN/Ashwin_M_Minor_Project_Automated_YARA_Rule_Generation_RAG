rule TEXT_Malware_10d91161_cluster
{
    meta:
        author = "malware-analyst"
        description = "Text-log YARA to detect the 10d91161... cluster â€” requires rare resource API tokens plus an exact PE header fingerprint cluster (tuned to avoid the provided benign neighbors)."
        reference_sha256 = "10d9116113ccbdde796c05b5e1dfb28d88f900ff87c99e83689934fd0cd0e829"
        created = "2025-11-30"
        tlp = "white"

    strings:
        /* Rare/diagnostic resource APIs present in positives but not in supplied benign set */
        $s_sizeofresource    = "sizeofresource" ascii nocase
        $s_loadresource      = "loadresource" ascii nocase

        /* High-fidelity PE header / section fingerprints (text-log form) observed across positives */
        $h_tstamp            = "TimeDateStamp is 1592301645" ascii
        $h_sections4         = "NumberOfSections is 4" ascii
        $h_sizecode          = "SizeOfCode is 49152" ascii
        $h_sizeinit          = "SizeOfInitializedData is 446464" ascii
        $h_aep               = "AddressOfEntryPoint is 22132" ascii
        $h_textraw           = "text_SizeOfRawData is 49152" ascii
        $h_lfanew224         = "e_lfanew is 224" ascii
        $h_filealign4096     = "FileAlignment is 4096" ascii

    condition:
        /*
         * Conservative matching:
         *  - Require the rare resource-related API tokens (reduces false positives against benigns)
         *  - Require the exact TimeDateStamp seen in malware positives
         *  - Require the same section-count (4)
         *  - Require at least three additional high-fidelity header/section fingerprints to confirm the cluster
         *
         * This combination intentionally avoids benign neighbors that share common APIs/DLLs but do not
         * reproduce this particular set of header fingerprints + resource API usage.
         */
        $s_sizeofresource and $s_loadresource and
        $h_tstamp and $h_sections4 and
        (3 of ( $h_sizecode, $h_sizeinit, $h_aep, $h_textraw, $h_lfanew224, $h_filealign4096 ))
}
