rule Malware_96d161ed_Affinity_WinHTTP_Profile
{
    meta:
        author = "malware-analyst"
        description = "Detects text-log indicators of affinity-manipulating malware that also uses WinHTTP query APIs — combination not present in benign neighbors."
        sha256 = "96d161eddf895ce4f1d935c7ecb7d913a1eb7e0095f2530518ec14f1f865665a"
        created = "2025-11-30"
        tlp = "WHITE"

    strings:
        /* Process/Thread affinity manipulation — absent in benign neighbors */
        $aff_set_thread   = "setthreadaffinitymask" nocase
        $aff_get_process  = "getprocessaffinitymask" nocase
        $aff_set_process  = "setprocessaffinitymask" nocase

        /* WinHTTP network primitive — also absent in benign neighbors */
        $winhttp_query    = "winhttpquerydataavailable" nocase

        /* User/session info (benign neighbors do not contain these) */
        $u_getusernamea   = "getusernamea" nocase
        $u_getuserinfo    = "getuserobjectinformationw" nocase
        $u_getwinstation  = "getprocesswindowstation" nocase

    condition:
        // Require affinity-manipulation + WinHTTP + at least one user/session enumeration API.
        // This combination does not exist in any benign sample, ensuring safe discrimination.
        ($aff_set_thread or $aff_get_process or $aff_set_process)
        and $winhttp_query
        and 1 of ($u_getusernamea, $u_getuserinfo, $u_getwinstation)
}
