rule Detect_New_Malware_55e79c0a
{
    meta:
        description = "Detects text-log based malware sample 55e79c0a and neighbors using specific API and DLL indicators related to GDI+ and console manipulation."
        author = "malware-analyst"
        sha256 = "55e79c0ae518b6440b2778a324c7874f2a689cea94d430e1b381eb4e20623261"
        created = "2023-10-27"

    strings:
        // Behavioral Indicators (APIs from new sample and neighbors)
        $api_getsyscolorbrush = "getsyscolorbrush"
        $api_variantchangetypeex = "variantchangetypeex"
        $api_charupperbuffw = "charupperbuffw"
        
        // Contextual APIs (Present in target but common, use for context only)
        $api_getprocaddress = "getprocaddress"
        $api_getmodulehandlea = "getmodulehandlea"
        $api_raiseexception = "raiseexception"
        $api_loadlibrarya = "loadlibrarya"

        // Imported DLLs
        $dll_oleaut32 = "oleaut32.dll"
        $dll_user32 = "user32.dll"
        $dll_kernel32 = "kernel32.dll"

        // Benign Filter strings (to avoid) - Implicitly handled by selection of specific APIs above which are absent in benign context provided.
        // However, explicit exclusion of purely generic combos is good practice if rule matches broadly. 
        // Based on provided negative context, the above APIs are not present.

    condition:
        // Logic: 
        // 1. Must include specific DLLs found in target (oleaut32, user32) AND strong unique API indicators.
        // 2. The combination of GetSysColorBrush and VariantChangeTypeEx along with CharUpperBuffW is the specific behavior pattern to match, absent in the provided benign samples.
        
        $dll_oleaut32 and $dll_user32 and $dll_kernel32 and
        $api_getsyscolorbrush and $api_variantchangetypeex and $api_charupperbuffw and
        ($api_getprocaddress or $api_getmodulehandlea or $api_raiseexception or $api_loadlibrarya)
}