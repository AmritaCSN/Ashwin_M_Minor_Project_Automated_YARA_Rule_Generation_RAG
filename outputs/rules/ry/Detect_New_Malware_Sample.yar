rule Detect_New_Malware_Sample {
    meta:
        description = "Detects behavior indicative of the new malware sample"
        author = "Malware Analyst"
        date = "2023-10-10"
        sha256 = "1ebe38986d47f90019956195461098bb545930903e94652efe73b8d4103ca1bb"

    strings:
        $api_setunhandledexceptionfilter = "setunhandledexceptionfilter"
        $api_getprocaddress = "getprocaddress"
        $api_getcurrentprocessid = "getcurrentprocessid"
        $api_multibytetowidechar = "multibytetowidechar"
        $api_createfilew = "createfilew"
        $api_widechartomultibyte = "widechartomultibyte"
        $api_virtualalloc = "virtualalloc"
        $api_dispatchmessagea = "dispatchmessagea"
        $api_postquitmessage = "postquitmessage"
        $api_translatemessage = "translatemessage"
        $api_registerclassexa = "registerclassexa"
        $api_createwindowexa = "createwindowexa"

    condition:
        uint16(0) == 0x5A4D and
        all of ($api_setunhandledexceptionfilter, $api_getprocaddress, $api_getcurrentprocessid, $api_multibytetowidechar, $api_createfilew, $api_widechartomultibyte, $api_virtualalloc, $api_dispatchmessagea, $api_postquitmessage, $api_translatemessage, $api_registerclassexa, $api_createwindowexa)
}